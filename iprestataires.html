<script>
        // Variables globales (utilisées par votre viiveo-app.js)
        // NOTE: Si vous utilisez le Cloudflare Worker, l'URL ci-dessous doit être celle du Worker.
        // Si vous utilisez Google Apps Script (comme l'URL actuelle le suggère), l'URL est correcte.
        window.webAppUrl = "https://script.google.com/macros/s/AKfycbzEEZZnZJK1BEXlCk81ogi0Aa7MFGunOkjS5s2CCDIZPSkHq0OtPAcEBLrkXp-fpb8aaQ/exec";
        window.currentEmail = null;
        window.currentPrenom = null;
        window.currentNom = null;

        /**
         * @function handleLogin
         * Appelée par le formulaire. Elle initialise la connexion et affiche le loader.
         */
        function handleLogin() {
            const emailInput = document.getElementById('email').value;
            const passwordInput = document.getElementById('password').value;
            const loaderWrapper = document.getElementById('loader-wrapper');
            const loginSection = document.getElementById('login-section');
            const errorMessage = document.getElementById('message');

            // 1. Masquer le formulaire et afficher le loader
            loginSection.style.display = 'none';
            loaderWrapper.style.display = 'block';
            errorMessage.textContent = ''; // Effacer l'ancien message d'erreur
            errorMessage.style.visibility = 'hidden';

            // 2. Appeler la fonction d'authentification dans viiveo-app.js
            if (typeof window.viiveoLogin === 'function') {
                // Cette fonction DOIT exister et être fonctionnelle dans viiveo-app.js
                window.viiveoLogin(emailInput, passwordInput);
            } else {
                // Message d'erreur si viiveo-app.js est manquant ou ne contient pas la fonction
                console.error("Erreur: La fonction window.viiveoLogin n'est pas définie dans viiveo-app.js.");
                handleLoginError("Erreur interne: La logique de connexion est introuvable. Veuillez vérifier viiveo-app.js.");
            }
        }
        
        /**
         * @function handleLoginError
         * Appelée par viiveo-app.js en cas d'échec de l'authentification.
         */
        window.handleLoginError = function(message) {
            const loaderWrapper = document.getElementById('loader-wrapper');
            const loginSection = document.getElementById('login-section');
            const errorMessage = document.getElementById('message');

            // 1. Masquer le loader et réafficher le formulaire
            loaderWrapper.style.display = 'none';
            loginSection.style.display = 'block';

            // 2. Afficher le message d'erreur
            errorMessage.textContent = message;
            errorMessage.style.visibility = 'visible';
        };


        // Fonction pour initialiser les données du prestataire (utilisée par handleSuccessfulLogin)
        window.setPrestataireData = function(email, prenom, nom) {
            if (typeof email === 'string' && email.includes('@')) {
                window.currentEmail = email;
                window.currentPrenom = prenom || '';
                window.currentNom = nom || '';
                console.log(`Prestataire connecté : ${window.currentPrenom} ${window.currentNom} (${window.currentEmail})`);
            } else {
                console.error("Erreur: L'email du prestataire fourni n'est pas valide.");
            }
        };

        /**
         * @function handleSuccessfulLogin
         * Appelée par viiveo-app.js après une authentification réussie.
         * Elle gère l'affichage des éléments post-connexion (y compris le menu hamburger).
         */
        window.handleSuccessfulLogin = function(email, prenom, nom) {
            window.setPrestataireData(email, prenom, nom);

            // 1. Masquer le formulaire de connexion et le loader
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('loader-wrapper').style.display = 'none';

            // 2. Afficher les sections du prestataire, y compris le menu hamburger
            document.getElementById('main-missions-display').style.display = 'block';
            document.getElementById('actions-section').style.display = 'block';
            document.getElementById('menu-container').style.display = 'block'; // AFFICHAGE DU MENU HAMBURGER

            // 3. Mettre à jour le message d'accueil
            const welcomeTitle = document.querySelector('.welcome-section h1');
            const welcomeP = document.querySelector('.welcome-section p');
            welcomeTitle.innerHTML = `<i class="fas fa-user-tie"></i> Bienvenue, ${prenom} !`;
            welcomeP.textContent = `Gérez vos missions Viiveo.`;
        }
        
        // --- NOUVELLE FONCTION : Basculer la visibilité du mot de passe ---
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('togglePassword');
            
            // Bascule entre 'password' et 'text'
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash'); // Icône pour masquer
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye'); // Icône pour afficher
            }
        }

        // Fonctions pour le menu hamburger (logique inchangée)
        function showHistorique() {
            alert("Affichage de l'historique des prestations.");
            closeMenu();
        }

        function showMesDonnees() {
            alert("Fonctionnalité 'Mes données' à venir.");
            closeMenu();
        }

        function closeMenu() {
            document.getElementById('menu-toggle').checked = false;
            // Assurez-vous que le menu lui-même est masqué si la case n'est pas cochée (dépend du CSS/nav)
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Logique d'initialisation...
            console.log('Interface prestataire initialisée');
        });
    </script>
</body>
</html>
